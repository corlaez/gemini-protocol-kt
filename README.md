# Ktor Gemini

A Kotlin Gemini server based on ktor-network.

## Features

* Easy routing config for dynamic responses and static file responses
* TLS 1.2 and 1.3 support
* Supports Let's Encrypt and generates self-signed certificates for dev/test
* An almost complete Gemini client implementation (client certificates are not supported)
* Early implementation, expect rough edges (issues/PRs welcome)

## Usage

Gemini requires TLS 1.2 or 1.3. This library supports 3 ways to easily configure TLS:

### 1. Autogenerated self-signed certificate

Zero setup, great to test locally, but it's not recommended for production.
```kotlin
    val certConfig = CertificateConfig.GeneratedSelfSigned()
    val server = GeminiServer("0.0.0.0", 1965, certConfig)
```

### 2. Read self-signed certificate and private key from files

Self-signed certificates are allowed in production for Gemini clients. You can generate them with openssl, for instance:

1. This generates a 3072-bit RSA private key and encrypts it with AES-256 (You will be prompted to enter a Pass Phrase)
```
openssl genrsa -aes256 -out private.key 3072
```

2. This generates a self-signed certificate valid for 365 days using the private key. (You will be prompted for the same Pass Phrase as above, and for identity details)

```
openssl req -new -x509 -sha256 -key private.key -out cert.pem -days 365
```

Then, you can read the certificate and private key from files:

```kotlin
    val certConfig = CertificateConfig.FileSelfSigned(
        privateKeyPath = "./src/main/resources/gitignored/private.key",
        certPemPath = "./src/main/resources/gitignored/cert.pem",
        privateKeyPassword = getEnvAsCharArray("PRIVATE_KEY_PASSWORD") ?: CharArray(0)
    )
    val server = GeminiServer("0.0.0.0", 1965, certConfig)
```

### 2. Read from Let's Encrypt generated files

This may need to be expanded, but at least for the Let's Encrypt I generated around 2024 this implementation works:

```kotlin
    val certConfig = CertificateConfig.LetsEncrypt.fromDomain("corlaez.com")
    val server = GeminiServer("0.0.0.0", 1965, certConfig)
```

which can also be written as (in case you have a different path):
```kotlin
    val domain = "corlaez.com"
    val certConfig = CertificateConfig.LetsEncrypt(
        privateKeyPath = "/etc/letsencrypt/live/$domain/privkey.pem",
        fullchainPath = "/etc/letsencrypt/live/$domain/fullchain.pem"
    )
    val server = GeminiServer("0.0.0.0", 1965, certConfig)
```
  
This assumes that you have set up let's encrypt properly and that your generated files are compatible with the code I provided here (this may need to be expanded)
